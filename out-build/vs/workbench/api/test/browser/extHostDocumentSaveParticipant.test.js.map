{"version":3,"sources":["file:///workspace/appflow/src/vs/workbench/api/test/browser/extHostDocumentSaveParticipant.test.ts"],"names":[],"mappings":"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","file":"extHostDocumentSaveParticipant.test.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport * as assert from 'assert';\nimport { URI } from 'vs/base/common/uri';\nimport { ExtHostDocuments } from 'vs/workbench/api/common/extHostDocuments';\nimport { ExtHostDocumentsAndEditors } from 'vs/workbench/api/common/extHostDocumentsAndEditors';\nimport { TextDocumentSaveReason, TextEdit, Position, EndOfLine } from 'vs/workbench/api/common/extHostTypes';\nimport { MainThreadTextEditorsShape, IWorkspaceEditDto, IWorkspaceTextEditDto, MainThreadBulkEditsShape } from 'vs/workbench/api/common/extHost.protocol';\nimport { ExtHostDocumentSaveParticipant } from 'vs/workbench/api/common/extHostDocumentSaveParticipant';\nimport { SingleProxyRPCProtocol } from 'vs/workbench/api/test/common/testRPCProtocol';\nimport { SaveReason } from 'vs/workbench/common/editor';\nimport type * as vscode from 'vscode';\nimport { mock } from 'vs/base/test/common/mock';\nimport { NullLogService } from 'vs/platform/log/common/log';\nimport { timeout } from 'vs/base/common/async';\nimport { nullExtensionDescription } from 'vs/workbench/services/extensions/common/extensions';\n\nsuite('ExtHostDocumentSaveParticipant', () => {\n\n\tconst resource = URI.parse('foo:bar');\n\tconst mainThreadBulkEdits = new class extends mock<MainThreadBulkEditsShape>() { };\n\tlet documents: ExtHostDocuments;\n\tconst nullLogService = new NullLogService();\n\n\tsetup(() => {\n\t\tconst documentsAndEditors = new ExtHostDocumentsAndEditors(SingleProxyRPCProtocol(null), new NullLogService());\n\t\tdocumentsAndEditors.$acceptDocumentsAndEditorsDelta({\n\t\t\taddedDocuments: [{\n\t\t\t\tisDirty: false,\n\t\t\t\tlanguageId: 'foo',\n\t\t\t\turi: resource,\n\t\t\t\tversionId: 1,\n\t\t\t\tlines: ['foo'],\n\t\t\t\tEOL: '\\n',\n\t\t\t}]\n\t\t});\n\t\tdocuments = new ExtHostDocuments(SingleProxyRPCProtocol(null), documentsAndEditors);\n\t});\n\n\ttest('no listeners, no problem', () => {\n\t\tconst participant = new ExtHostDocumentSaveParticipant(nullLogService, documents, mainThreadBulkEdits);\n\t\treturn participant.$participateInSave(resource, SaveReason.EXPLICIT).then(() => assert.ok(true));\n\t});\n\n\ttest('event delivery', () => {\n\t\tconst participant = new ExtHostDocumentSaveParticipant(nullLogService, documents, mainThreadBulkEdits);\n\n\t\tlet event: vscode.TextDocumentWillSaveEvent;\n\t\tconst sub = participant.getOnWillSaveTextDocumentEvent(nullExtensionDescription)(function (e) {\n\t\t\tevent = e;\n\t\t});\n\n\t\treturn participant.$participateInSave(resource, SaveReason.EXPLICIT).then(() => {\n\t\t\tsub.dispose();\n\n\t\t\tassert.ok(event);\n\t\t\tassert.strictEqual(event.reason, TextDocumentSaveReason.Manual);\n\t\t\tassert.strictEqual(typeof event.waitUntil, 'function');\n\t\t});\n\t});\n\n\ttest('event delivery, immutable', () => {\n\t\tconst participant = new ExtHostDocumentSaveParticipant(nullLogService, documents, mainThreadBulkEdits);\n\n\t\tlet event: vscode.TextDocumentWillSaveEvent;\n\t\tconst sub = participant.getOnWillSaveTextDocumentEvent(nullExtensionDescription)(function (e) {\n\t\t\tevent = e;\n\t\t});\n\n\t\treturn participant.$participateInSave(resource, SaveReason.EXPLICIT).then(() => {\n\t\t\tsub.dispose();\n\n\t\t\tassert.ok(event);\n\t\t\tassert.throws(() => { (event.document as any) = null!; });\n\t\t});\n\t});\n\n\ttest('event delivery, bad listener', () => {\n\t\tconst participant = new ExtHostDocumentSaveParticipant(nullLogService, documents, mainThreadBulkEdits);\n\n\t\tconst sub = participant.getOnWillSaveTextDocumentEvent(nullExtensionDescription)(function (e) {\n\t\t\tthrow new Error('ðŸ’€');\n\t\t});\n\n\t\treturn participant.$participateInSave(resource, SaveReason.EXPLICIT).then(values => {\n\t\t\tsub.dispose();\n\n\t\t\tconst [first] = values;\n\t\t\tassert.strictEqual(first, false);\n\t\t});\n\t});\n\n\ttest('event delivery, bad listener doesn\\'t prevent more events', () => {\n\t\tconst participant = new ExtHostDocumentSaveParticipant(nullLogService, documents, mainThreadBulkEdits);\n\n\t\tconst sub1 = participant.getOnWillSaveTextDocumentEvent(nullExtensionDescription)(function (e) {\n\t\t\tthrow new Error('ðŸ’€');\n\t\t});\n\t\tlet event: vscode.TextDocumentWillSaveEvent;\n\t\tconst sub2 = participant.getOnWillSaveTextDocumentEvent(nullExtensionDescription)(function (e) {\n\t\t\tevent = e;\n\t\t});\n\n\t\treturn participant.$participateInSave(resource, SaveReason.EXPLICIT).then(() => {\n\t\t\tsub1.dispose();\n\t\t\tsub2.dispose();\n\n\t\t\tassert.ok(event);\n\t\t});\n\t});\n\n\ttest('event delivery, in subscriber order', () => {\n\t\tconst participant = new ExtHostDocumentSaveParticipant(nullLogService, documents, mainThreadBulkEdits);\n\n\t\tlet counter = 0;\n\t\tconst sub1 = participant.getOnWillSaveTextDocumentEvent(nullExtensionDescription)(function (event) {\n\t\t\tassert.strictEqual(counter++, 0);\n\t\t});\n\n\t\tconst sub2 = participant.getOnWillSaveTextDocumentEvent(nullExtensionDescription)(function (event) {\n\t\t\tassert.strictEqual(counter++, 1);\n\t\t});\n\n\t\treturn participant.$participateInSave(resource, SaveReason.EXPLICIT).then(() => {\n\t\t\tsub1.dispose();\n\t\t\tsub2.dispose();\n\t\t});\n\t});\n\n\ttest('event delivery, ignore bad listeners', async () => {\n\t\tconst participant = new ExtHostDocumentSaveParticipant(nullLogService, documents, mainThreadBulkEdits, { timeout: 5, errors: 1 });\n\n\t\tlet callCount = 0;\n\t\tconst sub = participant.getOnWillSaveTextDocumentEvent(nullExtensionDescription)(function (event) {\n\t\t\tcallCount += 1;\n\t\t\tthrow new Error('boom');\n\t\t});\n\n\t\tawait participant.$participateInSave(resource, SaveReason.EXPLICIT);\n\t\tawait participant.$participateInSave(resource, SaveReason.EXPLICIT);\n\t\tawait participant.$participateInSave(resource, SaveReason.EXPLICIT);\n\t\tawait participant.$participateInSave(resource, SaveReason.EXPLICIT);\n\n\t\tsub.dispose();\n\t\tassert.strictEqual(callCount, 2);\n\t});\n\n\ttest('event delivery, overall timeout', async function () {\n\t\tconst participant = new ExtHostDocumentSaveParticipant(nullLogService, documents, mainThreadBulkEdits, { timeout: 20, errors: 5 });\n\n\t\t// let callCount = 0;\n\t\tconst calls: number[] = [];\n\t\tconst sub1 = participant.getOnWillSaveTextDocumentEvent(nullExtensionDescription)(function (event) {\n\t\t\tcalls.push(1);\n\t\t});\n\n\t\tconst sub2 = participant.getOnWillSaveTextDocumentEvent(nullExtensionDescription)(function (event) {\n\t\t\tcalls.push(2);\n\t\t\tevent.waitUntil(timeout(100));\n\t\t});\n\n\t\tconst sub3 = participant.getOnWillSaveTextDocumentEvent(nullExtensionDescription)(function (event) {\n\t\t\tcalls.push(3);\n\t\t});\n\n\t\tconst values = await participant.$participateInSave(resource, SaveReason.EXPLICIT);\n\t\tsub1.dispose();\n\t\tsub2.dispose();\n\t\tsub3.dispose();\n\t\tassert.deepStrictEqual(calls, [1, 2]);\n\t\tassert.strictEqual(values.length, 2);\n\t});\n\n\ttest('event delivery, waitUntil', () => {\n\t\tconst participant = new ExtHostDocumentSaveParticipant(nullLogService, documents, mainThreadBulkEdits);\n\n\t\tconst sub = participant.getOnWillSaveTextDocumentEvent(nullExtensionDescription)(function (event) {\n\n\t\t\tevent.waitUntil(timeout(10));\n\t\t\tevent.waitUntil(timeout(10));\n\t\t\tevent.waitUntil(timeout(10));\n\t\t});\n\n\t\treturn participant.$participateInSave(resource, SaveReason.EXPLICIT).then(() => {\n\t\t\tsub.dispose();\n\t\t});\n\n\t});\n\n\ttest('event delivery, waitUntil must be called sync', () => {\n\t\tconst participant = new ExtHostDocumentSaveParticipant(nullLogService, documents, mainThreadBulkEdits);\n\n\t\tconst sub = participant.getOnWillSaveTextDocumentEvent(nullExtensionDescription)(function (event) {\n\n\t\t\tevent.waitUntil(new Promise<undefined>((resolve, reject) => {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tassert.throws(() => event.waitUntil(timeout(10)));\n\t\t\t\t\t\tresolve(undefined);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\treject(e);\n\t\t\t\t\t}\n\n\t\t\t\t}, 10);\n\t\t\t}));\n\t\t});\n\n\t\treturn participant.$participateInSave(resource, SaveReason.EXPLICIT).then(() => {\n\t\t\tsub.dispose();\n\t\t});\n\t});\n\n\ttest('event delivery, waitUntil will timeout', function () {\n\n\t\tconst participant = new ExtHostDocumentSaveParticipant(nullLogService, documents, mainThreadBulkEdits, { timeout: 5, errors: 3 });\n\n\t\tconst sub = participant.getOnWillSaveTextDocumentEvent(nullExtensionDescription)(function (event) {\n\t\t\tevent.waitUntil(timeout(100));\n\t\t});\n\n\t\treturn participant.$participateInSave(resource, SaveReason.EXPLICIT).then(values => {\n\t\t\tsub.dispose();\n\n\t\t\tconst [first] = values;\n\t\t\tassert.strictEqual(first, false);\n\t\t});\n\t});\n\n\ttest('event delivery, waitUntil failure handling', () => {\n\t\tconst participant = new ExtHostDocumentSaveParticipant(nullLogService, documents, mainThreadBulkEdits);\n\n\t\tconst sub1 = participant.getOnWillSaveTextDocumentEvent(nullExtensionDescription)(function (e) {\n\t\t\te.waitUntil(Promise.reject(new Error('dddd')));\n\t\t});\n\n\t\tlet event: vscode.TextDocumentWillSaveEvent;\n\t\tconst sub2 = participant.getOnWillSaveTextDocumentEvent(nullExtensionDescription)(function (e) {\n\t\t\tevent = e;\n\t\t});\n\n\t\treturn participant.$participateInSave(resource, SaveReason.EXPLICIT).then(() => {\n\t\t\tassert.ok(event);\n\t\t\tsub1.dispose();\n\t\t\tsub2.dispose();\n\t\t});\n\t});\n\n\ttest('event delivery, pushEdits sync', () => {\n\n\t\tlet dto: IWorkspaceEditDto;\n\t\tconst participant = new ExtHostDocumentSaveParticipant(nullLogService, documents, new class extends mock<MainThreadTextEditorsShape>() {\n\t\t\t$tryApplyWorkspaceEdit(_edits: IWorkspaceEditDto) {\n\t\t\t\tdto = _edits;\n\t\t\t\treturn Promise.resolve(true);\n\t\t\t}\n\t\t});\n\n\t\tconst sub = participant.getOnWillSaveTextDocumentEvent(nullExtensionDescription)(function (e) {\n\t\t\te.waitUntil(Promise.resolve([TextEdit.insert(new Position(0, 0), 'bar')]));\n\t\t\te.waitUntil(Promise.resolve([TextEdit.setEndOfLine(EndOfLine.CRLF)]));\n\t\t});\n\n\t\treturn participant.$participateInSave(resource, SaveReason.EXPLICIT).then(() => {\n\t\t\tsub.dispose();\n\n\t\t\tassert.strictEqual(dto.edits.length, 2);\n\t\t\tassert.ok((<IWorkspaceTextEditDto>dto.edits[0]).textEdit);\n\t\t\tassert.ok((<IWorkspaceTextEditDto>dto.edits[1]).textEdit);\n\t\t});\n\t});\n\n\ttest('event delivery, concurrent change', () => {\n\n\t\tlet edits: IWorkspaceEditDto;\n\t\tconst participant = new ExtHostDocumentSaveParticipant(nullLogService, documents, new class extends mock<MainThreadTextEditorsShape>() {\n\t\t\t$tryApplyWorkspaceEdit(_edits: IWorkspaceEditDto) {\n\t\t\t\tedits = _edits;\n\t\t\t\treturn Promise.resolve(true);\n\t\t\t}\n\t\t});\n\n\t\tconst sub = participant.getOnWillSaveTextDocumentEvent(nullExtensionDescription)(function (e) {\n\n\t\t\t// concurrent change from somewhere\n\t\t\tdocuments.$acceptModelChanged(resource, {\n\t\t\t\tchanges: [{\n\t\t\t\t\trange: { startLineNumber: 1, startColumn: 1, endLineNumber: 1, endColumn: 1 },\n\t\t\t\t\trangeOffset: undefined!,\n\t\t\t\t\trangeLength: undefined!,\n\t\t\t\t\ttext: 'bar'\n\t\t\t\t}],\n\t\t\t\teol: undefined!,\n\t\t\t\tversionId: 2,\n\t\t\t\tisRedoing: false,\n\t\t\t\tisUndoing: false,\n\t\t\t}, true);\n\n\t\t\te.waitUntil(Promise.resolve([TextEdit.insert(new Position(0, 0), 'bar')]));\n\t\t});\n\n\t\treturn participant.$participateInSave(resource, SaveReason.EXPLICIT).then(values => {\n\t\t\tsub.dispose();\n\n\t\t\tassert.strictEqual(edits, undefined);\n\t\t\tassert.strictEqual(values[0], false);\n\t\t});\n\n\t});\n\n\ttest('event delivery, two listeners -> two document states', () => {\n\n\t\tconst participant = new ExtHostDocumentSaveParticipant(nullLogService, documents, new class extends mock<MainThreadTextEditorsShape>() {\n\t\t\t$tryApplyWorkspaceEdit(dto: IWorkspaceEditDto) {\n\n\t\t\t\tfor (const edit of dto.edits) {\n\n\t\t\t\t\tconst uri = URI.revive((<IWorkspaceTextEditDto>edit).resource);\n\t\t\t\t\tconst { text, range } = (<IWorkspaceTextEditDto>edit).textEdit;\n\t\t\t\t\tdocuments.$acceptModelChanged(uri, {\n\t\t\t\t\t\tchanges: [{\n\t\t\t\t\t\t\trange,\n\t\t\t\t\t\t\ttext,\n\t\t\t\t\t\t\trangeOffset: undefined!,\n\t\t\t\t\t\t\trangeLength: undefined!,\n\t\t\t\t\t\t}],\n\t\t\t\t\t\teol: undefined!,\n\t\t\t\t\t\tversionId: documents.getDocumentData(uri)!.version + 1,\n\t\t\t\t\t\tisRedoing: false,\n\t\t\t\t\t\tisUndoing: false,\n\t\t\t\t\t}, true);\n\t\t\t\t\t// }\n\t\t\t\t}\n\n\t\t\t\treturn Promise.resolve(true);\n\t\t\t}\n\t\t});\n\n\t\tconst document = documents.getDocument(resource);\n\n\t\tconst sub1 = participant.getOnWillSaveTextDocumentEvent(nullExtensionDescription)(function (e) {\n\t\t\t// the document state we started with\n\t\t\tassert.strictEqual(document.version, 1);\n\t\t\tassert.strictEqual(document.getText(), 'foo');\n\n\t\t\te.waitUntil(Promise.resolve([TextEdit.insert(new Position(0, 0), 'bar')]));\n\t\t});\n\n\t\tconst sub2 = participant.getOnWillSaveTextDocumentEvent(nullExtensionDescription)(function (e) {\n\t\t\t// the document state AFTER the first listener kicked in\n\t\t\tassert.strictEqual(document.version, 2);\n\t\t\tassert.strictEqual(document.getText(), 'barfoo');\n\n\t\t\te.waitUntil(Promise.resolve([TextEdit.insert(new Position(0, 0), 'bar')]));\n\t\t});\n\n\t\treturn participant.$participateInSave(resource, SaveReason.EXPLICIT).then(values => {\n\t\t\tsub1.dispose();\n\t\t\tsub2.dispose();\n\n\t\t\t// the document state AFTER eventing is done\n\t\t\tassert.strictEqual(document.version, 3);\n\t\t\tassert.strictEqual(document.getText(), 'barbarfoo');\n\t\t});\n\n\t});\n\n\ttest('Log failing listener', function () {\n\t\tlet didLogSomething = false;\n\t\tconst participant = new ExtHostDocumentSaveParticipant(new class extends NullLogService {\n\t\t\toverride error(message: string | Error, ...args: any[]): void {\n\t\t\t\tdidLogSomething = true;\n\t\t\t}\n\t\t}, documents, mainThreadBulkEdits);\n\n\n\t\tconst sub = participant.getOnWillSaveTextDocumentEvent(nullExtensionDescription)(function (e) {\n\t\t\tthrow new Error('boom');\n\t\t});\n\n\t\treturn participant.$participateInSave(resource, SaveReason.EXPLICIT).then(() => {\n\t\t\tsub.dispose();\n\t\t\tassert.strictEqual(didLogSomething, true);\n\t\t});\n\t});\n});\n"]}