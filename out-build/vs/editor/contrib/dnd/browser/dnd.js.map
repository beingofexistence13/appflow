{"version":3,"sources":["file:///workspace/appflow/src/vs/editor/contrib/dnd/browser/dnd.ts"],"names":[],"mappings":"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","file":"dnd.js","sourceRoot":"file:///workspace/appflow/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IKeyboardEvent } from 'vs/base/browser/keyboardEvent';\nimport { IMouseEvent } from 'vs/base/browser/mouseEvent';\nimport { KeyCode } from 'vs/base/common/keyCodes';\nimport { Disposable } from 'vs/base/common/lifecycle';\nimport { isMacintosh } from 'vs/base/common/platform';\nimport 'vs/css!./dnd';\nimport { ICodeEditor, IEditorMouseEvent, IMouseTarget, IPartialEditorMouseEvent, MouseTargetType } from 'vs/editor/browser/editorBrowser';\nimport { EditorContributionInstantiation, registerEditorContribution } from 'vs/editor/browser/editorExtensions';\nimport { CodeEditorWidget } from 'vs/editor/browser/widget/codeEditorWidget';\nimport { EditorOption } from 'vs/editor/common/config/editorOptions';\nimport { CursorChangeReason } from 'vs/editor/common/cursorEvents';\nimport { Position } from 'vs/editor/common/core/position';\nimport { Range } from 'vs/editor/common/core/range';\nimport { Selection } from 'vs/editor/common/core/selection';\nimport { IEditorContribution, IEditorDecorationsCollection, ScrollType } from 'vs/editor/common/editorCommon';\nimport { ModelDecorationOptions } from 'vs/editor/common/model/textModel';\nimport { DragAndDropCommand } from 'vs/editor/contrib/dnd/browser/dragAndDropCommand';\n\nfunction hasTriggerModifier(e: IKeyboardEvent | IMouseEvent): boolean {\n\tif (isMacintosh) {\n\t\treturn e.altKey;\n\t} else {\n\t\treturn e.ctrlKey;\n\t}\n}\n\nexport class DragAndDropController extends Disposable implements IEditorContribution {\n\n\tpublic static readonly ID = 'editor.contrib.dragAndDrop';\n\n\tprivate readonly _editor: ICodeEditor;\n\tprivate _dragSelection: Selection | null;\n\tprivate readonly _dndDecorationIds: IEditorDecorationsCollection;\n\tprivate _mouseDown: boolean;\n\tprivate _modifierPressed: boolean;\n\tstatic readonly TRIGGER_KEY_VALUE = isMacintosh ? KeyCode.Alt : KeyCode.Ctrl;\n\n\tstatic get(editor: ICodeEditor): DragAndDropController | null {\n\t\treturn editor.getContribution<DragAndDropController>(DragAndDropController.ID);\n\t}\n\n\tconstructor(editor: ICodeEditor) {\n\t\tsuper();\n\t\tthis._editor = editor;\n\t\tthis._dndDecorationIds = this._editor.createDecorationsCollection();\n\t\tthis._register(this._editor.onMouseDown((e: IEditorMouseEvent) => this._onEditorMouseDown(e)));\n\t\tthis._register(this._editor.onMouseUp((e: IEditorMouseEvent) => this._onEditorMouseUp(e)));\n\t\tthis._register(this._editor.onMouseDrag((e: IEditorMouseEvent) => this._onEditorMouseDrag(e)));\n\t\tthis._register(this._editor.onMouseDrop((e: IPartialEditorMouseEvent) => this._onEditorMouseDrop(e)));\n\t\tthis._register(this._editor.onMouseDropCanceled(() => this._onEditorMouseDropCanceled()));\n\t\tthis._register(this._editor.onKeyDown((e: IKeyboardEvent) => this.onEditorKeyDown(e)));\n\t\tthis._register(this._editor.onKeyUp((e: IKeyboardEvent) => this.onEditorKeyUp(e)));\n\t\tthis._register(this._editor.onDidBlurEditorWidget(() => this.onEditorBlur()));\n\t\tthis._register(this._editor.onDidBlurEditorText(() => this.onEditorBlur()));\n\t\tthis._mouseDown = false;\n\t\tthis._modifierPressed = false;\n\t\tthis._dragSelection = null;\n\t}\n\n\tprivate onEditorBlur() {\n\t\tthis._removeDecoration();\n\t\tthis._dragSelection = null;\n\t\tthis._mouseDown = false;\n\t\tthis._modifierPressed = false;\n\t}\n\n\tprivate onEditorKeyDown(e: IKeyboardEvent): void {\n\t\tif (!this._editor.getOption(EditorOption.dragAndDrop) || this._editor.getOption(EditorOption.columnSelection)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (hasTriggerModifier(e)) {\n\t\t\tthis._modifierPressed = true;\n\t\t}\n\n\t\tif (this._mouseDown && hasTriggerModifier(e)) {\n\t\t\tthis._editor.updateOptions({\n\t\t\t\tmouseStyle: 'copy'\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate onEditorKeyUp(e: IKeyboardEvent): void {\n\t\tif (!this._editor.getOption(EditorOption.dragAndDrop) || this._editor.getOption(EditorOption.columnSelection)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (hasTriggerModifier(e)) {\n\t\t\tthis._modifierPressed = false;\n\t\t}\n\n\t\tif (this._mouseDown && e.keyCode === DragAndDropController.TRIGGER_KEY_VALUE) {\n\t\t\tthis._editor.updateOptions({\n\t\t\t\tmouseStyle: 'default'\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate _onEditorMouseDown(mouseEvent: IEditorMouseEvent): void {\n\t\tthis._mouseDown = true;\n\t}\n\n\tprivate _onEditorMouseUp(mouseEvent: IEditorMouseEvent): void {\n\t\tthis._mouseDown = false;\n\t\t// Whenever users release the mouse, the drag and drop operation should finish and the cursor should revert to text.\n\t\tthis._editor.updateOptions({\n\t\t\tmouseStyle: 'text'\n\t\t});\n\t}\n\n\tprivate _onEditorMouseDrag(mouseEvent: IEditorMouseEvent): void {\n\t\tconst target = mouseEvent.target;\n\n\t\tif (this._dragSelection === null) {\n\t\t\tconst selections = this._editor.getSelections() || [];\n\t\t\tconst possibleSelections = selections.filter(selection => target.position && selection.containsPosition(target.position));\n\t\t\tif (possibleSelections.length === 1) {\n\t\t\t\tthis._dragSelection = possibleSelections[0];\n\t\t\t} else {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (hasTriggerModifier(mouseEvent.event)) {\n\t\t\tthis._editor.updateOptions({\n\t\t\t\tmouseStyle: 'copy'\n\t\t\t});\n\t\t} else {\n\t\t\tthis._editor.updateOptions({\n\t\t\t\tmouseStyle: 'default'\n\t\t\t});\n\t\t}\n\n\t\tif (target.position) {\n\t\t\tif (this._dragSelection.containsPosition(target.position)) {\n\t\t\t\tthis._removeDecoration();\n\t\t\t} else {\n\t\t\t\tthis.showAt(target.position);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _onEditorMouseDropCanceled() {\n\t\tthis._editor.updateOptions({\n\t\t\tmouseStyle: 'text'\n\t\t});\n\n\t\tthis._removeDecoration();\n\t\tthis._dragSelection = null;\n\t\tthis._mouseDown = false;\n\t}\n\n\tprivate _onEditorMouseDrop(mouseEvent: IPartialEditorMouseEvent): void {\n\t\tif (mouseEvent.target && (this._hitContent(mouseEvent.target) || this._hitMargin(mouseEvent.target)) && mouseEvent.target.position) {\n\t\t\tconst newCursorPosition = new Position(mouseEvent.target.position.lineNumber, mouseEvent.target.position.column);\n\n\t\t\tif (this._dragSelection === null) {\n\t\t\t\tlet newSelections: Selection[] | null = null;\n\t\t\t\tif (mouseEvent.event.shiftKey) {\n\t\t\t\t\tconst primarySelection = this._editor.getSelection();\n\t\t\t\t\tif (primarySelection) {\n\t\t\t\t\t\tconst { selectionStartLineNumber, selectionStartColumn } = primarySelection;\n\t\t\t\t\t\tnewSelections = [new Selection(selectionStartLineNumber, selectionStartColumn, newCursorPosition.lineNumber, newCursorPosition.column)];\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tnewSelections = (this._editor.getSelections() || []).map(selection => {\n\t\t\t\t\t\tif (selection.containsPosition(newCursorPosition)) {\n\t\t\t\t\t\t\treturn new Selection(newCursorPosition.lineNumber, newCursorPosition.column, newCursorPosition.lineNumber, newCursorPosition.column);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn selection;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t// Use `mouse` as the source instead of `api` and setting the reason to explicit (to behave like any other mouse operation).\n\t\t\t\t(<CodeEditorWidget>this._editor).setSelections(newSelections || [], 'mouse', CursorChangeReason.Explicit);\n\t\t\t} else if (!this._dragSelection.containsPosition(newCursorPosition) ||\n\t\t\t\t(\n\t\t\t\t\t(\n\t\t\t\t\t\thasTriggerModifier(mouseEvent.event) ||\n\t\t\t\t\t\tthis._modifierPressed\n\t\t\t\t\t) && (\n\t\t\t\t\t\tthis._dragSelection.getEndPosition().equals(newCursorPosition) || this._dragSelection.getStartPosition().equals(newCursorPosition)\n\t\t\t\t\t) // we allow users to paste content beside the selection\n\t\t\t\t)) {\n\t\t\t\tthis._editor.pushUndoStop();\n\t\t\t\tthis._editor.executeCommand(DragAndDropController.ID, new DragAndDropCommand(this._dragSelection, newCursorPosition, hasTriggerModifier(mouseEvent.event) || this._modifierPressed));\n\t\t\t\tthis._editor.pushUndoStop();\n\t\t\t}\n\t\t}\n\n\t\tthis._editor.updateOptions({\n\t\t\tmouseStyle: 'text'\n\t\t});\n\n\t\tthis._removeDecoration();\n\t\tthis._dragSelection = null;\n\t\tthis._mouseDown = false;\n\t}\n\n\tprivate static readonly _DECORATION_OPTIONS = ModelDecorationOptions.register({\n\t\tdescription: 'dnd-target',\n\t\tclassName: 'dnd-target'\n\t});\n\n\tpublic showAt(position: Position): void {\n\t\tthis._dndDecorationIds.set([{\n\t\t\trange: new Range(position.lineNumber, position.column, position.lineNumber, position.column),\n\t\t\toptions: DragAndDropController._DECORATION_OPTIONS\n\t\t}]);\n\t\tthis._editor.revealPosition(position, ScrollType.Immediate);\n\t}\n\n\tprivate _removeDecoration(): void {\n\t\tthis._dndDecorationIds.clear();\n\t}\n\n\tprivate _hitContent(target: IMouseTarget): boolean {\n\t\treturn target.type === MouseTargetType.CONTENT_TEXT ||\n\t\t\ttarget.type === MouseTargetType.CONTENT_EMPTY;\n\t}\n\n\tprivate _hitMargin(target: IMouseTarget): boolean {\n\t\treturn target.type === MouseTargetType.GUTTER_GLYPH_MARGIN ||\n\t\t\ttarget.type === MouseTargetType.GUTTER_LINE_NUMBERS ||\n\t\t\ttarget.type === MouseTargetType.GUTTER_LINE_DECORATIONS;\n\t}\n\n\tpublic override dispose(): void {\n\t\tthis._removeDecoration();\n\t\tthis._dragSelection = null;\n\t\tthis._mouseDown = false;\n\t\tthis._modifierPressed = false;\n\t\tsuper.dispose();\n\t}\n}\n\nregisterEditorContribution(DragAndDropController.ID, DragAndDropController, EditorContributionInstantiation.BeforeFirstInteraction);\n"]}